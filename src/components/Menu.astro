---
import menuData from "../data/menu.json";
---

<!-- メニューオーバーレイ（背景を覆う半透明の要素） -->
<div class="menu-overlay hidden" id="menu-overlay"></div>

<!-- メニューパネル -->
<section class="menu-panel hidden" id="menu-panel">
	<ul class="accordion-menu">
		{
			menuData.map((item) => (
				<li class="menu-container">
					{item.submenu ? (
						<>
							<button class="accordion-toggle">
								{item.label}
								<span class="arrow">＞</span>
							</button>
							<ul class="submenu">
								{item.submenu.map((sub) => (
									<li>
										<a href={sub.link}>{sub.label}</a>
									</li>
								))}
							</ul>
						</>
					) : (
						<a
							href={item.link}
							class="accordion-toggle"
							target={item.external ? "_blank" : undefined}
							rel={item.external ? "noopener noreferrer" : undefined}
						>
							{item.label}
						</a>
					)}
				</li>
			))
		}
	</ul>
</section>

<script type="module" defer>
	document.addEventListener("DOMContentLoaded", () => {
		// ハンバーガーメニュー全体をクリックするエリア（hb-icon-area が無ければ hb-menu を代替）
		const hbIconArea =
			document.getElementById("hb-icon-area") || document.getElementById("hb-menu");
		// メニュー全体のパネル
		const menuPanel = document.getElementById("menu-panel");
		// メニューのテキスト部分（任意）
		const menuText = document.getElementById("menu-text");
		// ハンバーガーメニューのアイコン部分（見た目用）
		const hbMenu = document.getElementById("hb-menu");
		// ページ上部のヘッダー要素（高さ計算用）
		const header = document.querySelector("header");
		// メニューを開いたときに表示される背景のオーバーレイ
		const menuOverlay = document.getElementById("menu-overlay");

		// 必要な要素が揃っていない場合は安全に終了（デバッグ用警告）
		if (!menuPanel || !menuOverlay || !hbIconArea) {
			console.warn("Menu init aborted: missing elements", {
				menuPanel,
				menuOverlay,
				hbIconArea,
			});
			return;
		}

		// メニューパネルの top をヘッダー高さに合わせる
		const adjustMenuPanelPosition = () => {
			const headerHeight = header ? header.offsetHeight : 0;
			menuPanel.style.top = `${headerHeight}px`;
		};

		adjustMenuPanelPosition();
		window.addEventListener("resize", adjustMenuPanelPosition);

		// ハンバーガーメニュークリックで開閉
		hbIconArea.addEventListener("click", () => {
			const isOpen = menuPanel.classList.toggle("open");
			if (menuText) menuText.textContent = isOpen ? "Close" : "Menu";
			if (hbMenu) hbMenu.classList.toggle("open", isOpen);
			menuOverlay.classList.toggle("open", isOpen);
		});

		// アコーディオン：button のみトグル、a は通常遷移
		document.querySelectorAll(".accordion-toggle").forEach((el) => {
			if (el.tagName && el.tagName.toLowerCase() === "button") {
				el.addEventListener("click", () => {
					const submenu = el.nextElementSibling;
					if (submenu) {
						submenu.classList.toggle("open");
						el.classList.toggle("open");
					}
				});
			}
		});

		// オーバーレイをクリックでメニューを閉じる
		menuOverlay.addEventListener("click", () => {
			menuPanel.classList.remove("open");
			menuOverlay.classList.remove("open");
			if (hbMenu) hbMenu.classList.remove("open");
			if (menuText) menuText.textContent = "Menu";
		});
	});
</script>

<style>
	.menu-panel {
		/* メニュー全体のスタイル */
		position: absolute; /* ページの上に重ねる */
		top: 0; /* 上端に配置 */
		right: 0; /* 右端に配置 */
		width: 70vw; /* 横幅を画面の70%に設定 */
		background: white; /* 背景色を白に設定 */
		z-index: 1000; /* 他の要素より前面に表示 */
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 軽い影を追加 */
		display: none; /* 初期状態では非表示 */
		align-items: right; /* 右寄せ */
		box-sizing: border-box; /* パディングやボーダーを含むサイズ計算 */
	}

	.menu-panel.hidden {
		/* hiddenクラスが付与された場合のスタイル */
		display: none; /* 非表示にする */
	}

	.menu-panel.open {
		/* openクラスが付与された場合のスタイル */
		display: block; /* 表示する */
	}

	.hidden {
		/* 汎用的な非表示クラス */
		display: none;
	}

	.accordion-menu {
		/* アコーディオンメニュー全体のスタイル */
		list-style: none; /* リストマーカーを非表示 */
		padding: 0; /* パディングをリセット */
		margin: auto; /* 中央揃え */
		font-size: 14px; /* フォントサイズを設定 */
		width: 95%; /* 横幅を95%に設定 */
		height: auto; /* 高さを自動調整 */
		display: block; /* ブロック要素として表示 */
	}

	.accordion-toggle {
		/* 各メニュー項目のスタイル */
		color: #333; /* テキストカラー */
		text-decoration: none; /* 下線を非表示 */
		font-size: 14px; /* フォントサイズ */
		border: 1px solid transparent; /* 境界線を透明に設定 */
		text-align: center; /* テキストを中央揃え */
		width: 100%; /* 横幅を100%に設定 */
		height: 40px; /* 高さを40pxに設定 */
		cursor: pointer; /* カーソルをポインターに変更 */
		display: flex; /* フレックスボックスを使用 */
		flex-shrink: 0; /* 子要素のサイズを固定 */
		justify-content: space-between; /* 子要素を左右に配置 */
		align-items: center; /* 子要素を中央揃え */
		background-color: #f1f1f1; /* 背景色 */
		border-top: 1px solid #c4c4c4; /* 上部に境界線を追加 */
		padding: 0px 10px; /* 左右にパディングを設定 */
		box-sizing: border-box; /* パディングやボーダーを含むサイズ計算 */
	}

	.accordion-toggle .arrow {
		/* 矢印アイコンのスタイル */
		transition: transform 0.3s ease; /* 回転アニメーションを追加 */
	}

	.accordion-toggle.open .arrow {
		/* openクラスが付与された場合の矢印アイコンのスタイル */
		transform: rotate(90deg); /* 矢印を90度回転 */
	}

	.submenu {
		/* サブメニュー全体のスタイル */
		display: none; /* 初期状態では非表示 */
		list-style: none; /* リストマーカーを非表示 */
		width: 100%; /* 横幅を100%に設定 */
		height: auto; /* 高さを自動調整 */
		padding: 0; /* パディングをリセット */
	}

	.submenu.open {
		/* openクラスが付与された場合のサブメニューのスタイル */
		display: block; /* 表示する */
	}

	.submenu li {
		/* サブメニューの各項目のスタイル */
		border-top: 1px solid #c4c4c4; /* 上部に境界線を追加 */
		height: 40px; /* 高さを40pxに設定 */
		display: flex; /* フレックスボックスを使用 */
		align-items: center; /* 子要素を中央揃え */
	}

	.submenu li a {
		/* サブメニュー内のリンクのスタイル */
		text-decoration: none; /* 下線を非表示 */
		color: #333; /* テキストカラー */
		width: 100%; /* 横幅を100%に設定 */
		height: 100%; /* 高さを100%に設定 */
		padding: 0 24px; /* 左右にパディングを設定 */
		display: flex; /* フレックスボックスを使用 */
		align-items: center; /* 子要素を中央揃え */
	}

	.menu-overlay {
		/* メニューオーバーレイのスタイル */
		position: fixed; /* ページ全体を覆う */
		top: 0; /* 上端に配置 */
		left: 0; /* 左端に配置 */
		right: 0; /* 右端に配置 */
		bottom: 0; /* 下端に配置 */
		background: rgba(217, 217, 217, 0.7); /* 半透明のグレー背景 */
		z-index: 999; /* メニューの下、他の要素の上に表示 */
		display: none; /* 初期状態では非表示 */
	}

	.menu-overlay.open {
		/* openクラスが付与された場合のオーバーレイのスタイル */
		display: block; /* 表示する */
	}

	/* タブレットサイズでの調整 */
	@media screen and (min-width: 480px) and (max-width: 1024px) {
		.accordion-toggle {
			height: 60px; /* 高さを60pxに調整 */
			font-size: 18px; /* フォントサイズを大きくする */
		}
		.submenu li {
			height: 60px; /* サブメニューの高さを調整 */
			font-size: 18px; /* フォントサイズを大きくする */
		}
	}

	/* PCサイズでの調整 */
	@media screen and (min-width: 1025px) {
		.accordion-toggle {
			height: 70px; /* 高さを70pxに調整 */
			font-size: 20px; /* フォントサイズをさらに大きくする */
		}
		.submenu li {
			height: 70px; /* サブメニューの高さを調整 */
			font-size: 20px; /* フォントサイズをさらに大きくする */
		}
	}
</style>
